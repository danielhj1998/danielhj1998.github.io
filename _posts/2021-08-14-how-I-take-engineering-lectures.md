---
layout: post
title: C√≥mo tomo mis notas de ingenier√≠a utilizando Vim y GitHub pages
tag: Vim Neovim
reading_time: 15
date_shown: 14 Ago 2021
excerpt_separator: <!--intro-->
---

Soy el tipo de persona que gusta de tener buenos apuntes ü§ì, porque s√© que mi yo del futuro me lo va a agradecer. Sin embargo, al iniciar la pandemia por Covid 19 üò∑ y con eso, las clases en l√≠nea en la universidad, tomaba todas mis clases en la laptop mientras escrib√≠a mis apuntes en el cuaderno. Realmente era algo inc√≥modo ‚òπ, pues ocupaba mucho m√°s espacio que antes y desde mi punto de vista no ten√≠a sentido que siguiera haci√©ndolo de esa manera, teniendo la PC encendida.

<!--intro-->

## Qu√© es lo que busco en una herramienta de notas?
1. **Notas al ritmo de la clase** üë®‚Äçüè´üí®.
    Necesito ser capaz de escribir enunciados claros, ideas y palabras clave, pero al ser clase de ingenier√≠a, debo de poder incluir ecuaciones matem√°ticas, gr√°ficos y c√≥digo en diferentes lenguajes.
2. **Temas estructurados, resaltar ideas y dejar notas para mi yo futuro** üß±.
    Me refiero a que los temas est√©n bien delimitados y que de forma r√°pida pueda ojear los apuntes e identificar d√≥nde est√° lo que busco. Esto lo hago usando t√≠tulos, diferentes tipos de letra y colores.
3. **Correcci√≥n de errores** üöß.
    En una libreta, normalmente uso corrector para maquillar los errores, adem√°s, los errores m√°s grandes implican realizar el apunte de nuevo. En este punto, las notas digitales ayudan much√≠simo.
4. **Practicidad de uso** üó∏.
    Una de las ventajas que tiene un cuaderno frente a la computadora, es que s√≥lo hay que abrirlo y buscar entre sus hojas, mientras que para la computadora hay que esperar a que encienda, luego buscar los archivos y abrirlos. Adem√°s una libreta se puede cargar donde sea y una laptop es mucho m√°s pesada, por ende es m√°s dif√≠cil de llevar a todos lados.
5. **Facilidad para compartir** üîó.
    Muchas veces mis compa√±eros de clase me ped√≠an mis notas para estudiar o ponerse al d√≠a con los temas. En ese sentido, es mejor tener apuntes digitales porque en el caso del cuaderno, se requiere tomar fotocopias o prestarlo ü•¥. Y obviamente pasar un simple archivo ser√≠a m√°s f√°cil... Claro!, siempre y cuando la otra persona no necesite instalar nada nuevo para verlo.

## Manos a la obra
Para encontrar la herramienta adecuada, comenc√© probando distintas alternativas, primero con [*Cherry Tree*](https://www.giuspen.com/cherrytree/) que tiene una muy buena organizaci√≥n de las notas, pero no tiene soporte para escribir matem√°ticas, luego con [*Word*](https://office.live.com/start/Word.aspx?ui=es%2DES) y aunque se pueden tomar notas con ecuaciones matem√°ticas, no es nada r√°pido y la organizaci√≥n de las notas tampoco lo es.

As√≠ llegu√© a [*Joplin*](https://joplinapp.org/) donde encontr√© una gran herramienta que me permiti√≥ usar [markdown](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet), [KaTeX](https://katex.org/docs/supported.html), [Vim](https://missing.csail.mit.edu/2020/editors/), y ten√≠a plugins muy interesantes que me convencieron de hacer mis notas ah√≠ por dos semestres. Vim hacia que pudiera escribir todo muy r√°pido y es lo que m√°s me gustaba.

Pero en ocasiones el profesor iba muy r√°pido, y por m√°s que intentaba, ten√≠a que concentrarme s√≥lo en escribir ecuaciones y dejaba de comprender el tema ü•¥, o incluso ten√≠a que quedarme m√°s tiempo ya concluida la clase, para terminar el apunte üòî.

## Snippets?

En `Vim`, yo ya estaba familiarizado con el uso de snippets, que utilizo mucho al momento de programar y hacen que todo sea m√°s r√°pido, les recomiendo ver [este tutorial](https://missing.csail.mit.edu/2020/editors/).

Los snippets sirven para autocompletar al momento de escribir una palabra.

![snippets intro](/blogger/assets/snippetsIntro.gif)

S√≥lo tengo que escribir `intro` y `firma` , presionar `<TAB>` y luego `ENTER` para insertar un texto predefinido. Esto hace una diferencia enorme al momento de de escribir c√≥digo $\KaTeX$.

![snippets con sin](/blogger/assets/snippetsComparison.gif)

A la izquierda se muestra el caso sin utilizar snippets y del lado derecho con snippets, que es m√°s r√°pido. El snippet lo defino con anterioridad y est√° configurado para desplegarse de forma autom√°tica, **sin** tener que **oprimir nada**.

En Joplin no se puede hacer esto puesto que s√≥lo tiene un emulador de `Vim` al escribir. Para implementar los plugins necesarios necesitamos `Vim` tal cual.

## Setup
As√≠ se ve cuando tomo notas para mi clase:

![workflow](/blogger/assets/workflow.gif)

Al terminar la clase, dado que las notas est√°n como archivos markdown `.md` en un repositorio `git`, s√≥lo hago un commit y acto seguido, tengo el apunte listo en mi p√°gina web. [He aqu√≠ el apunte del ejemplo](https://danielhj.com/studious/notes/7mo%20Semestre/Control%20de%20Sistemas%20Mecatr%C3%B3nicos/Discretizaci%C3%B3n%20de%20ecuaciones%20en%20espacio%20de%20estado.html).

Me encanta este arreglo ü§©, puesto que puedo seguir el ritmo de la clase. Todo est√° a unos cuantos comandos de distancia y al final tengo un apunte bien organizado y muy limpio, al cual puedo acceder desde cualquier dispositivo y puedo compartirlo f√°cilmente.

### ¬øC√≥mo funciona?

#### SO
Utilizo [WSL](https://docs.microsoft.com/en-us/windows/wsl/install-win10) que es el subsistema de Windows para Linux, as√≠ puedo tener una m√°quina virtual de Linux de forma nativa en Windows. En concreto uso [WSL 2](https://docs.microsoft.com/en-us/windows/wsl/install-win10#step-2---check-requirements-for-running-wsl-2) que permite tener pr√°cticamente la mayor√≠a de las funcionalidades de un sistema Linux, cosa que WSL 1 no puede dar.
Instal√© [Ubuntu](https://www.microsoft.com/store/apps/9n6svws3rx71), pero cualquier [distribuci√≥n](https://docs.microsoft.com/en-us/windows/wsl/install-win10#step-6---install-your-linux-distribution-of-choice) funciona.

#### Editor de texto
Lo siguiente y m√°s importante es el editor de texto, en este caso [Neovim](https://neovim.io/), es b√°sicamente un fork de [Vim](https://github.com/vim/vim), pero que mantiene la comunidad (ya que Vim es mantenido por su creador). Es un editor de texto desde la l√≠nea de comandos, es s√∫per personalizable, tiene su propio lenguaje de programaci√≥n y existen much√≠simos plugins que permiten hacer de todo con √©l y de formas muy eficientes. De hecho est√° dise√±ado para utilizar √∫nicamente el teclado.

##### Plugins
Los plugins que utilizo son los siguientes:
* [Vim-plug](https://github.com/junegunn/vim-plug): Este es el administrador de plugins, hace que sea mucho m√°s r√°pidos instalarlos y desinstalarlos.
* [VimWiki](https://github.com/vimwiki/vimwiki): El administrador de notas que nos ayuda a crear notas de forma f√°cil, administrarlas y acceder a ellas de forma r√°pida.
    ![vimwiki navigation](/blogger/assets/vimwikiNav.gif)

    La creaci√≥n de nuevas notas se hace de forma autom√°tica al crear un link:
    ![vimwiki creation](/blogger/assets/vimwikiNewNote.gif)

    En mi `.config/nvim/init.vim` (equivalente a `.vimrc`) tengo esta configuraci√≥n. Primero para crear la vimwiki donde albergo mis notas escolares, utilizando s√≥lo archivos tipo markdown:

    ```vim
    let studiousWiki = {}
    let studiousWiki.path = '/mnt/c/Users/Dani/Documents/Tareas/studious/'
    let studiousWiki.syntax = 'markdown'
    let studiousWiki.ext = '.md'
    let g:vimwiki_list = [studiousWiki]
    ```

    La siguiente configuraci√≥n es necesaria para que no interfiera la funcionalidad de `<TAB>` en vimwiki para saltar entre links, con la de `coc-snippets` para navegar entre snippets:


    ```vim
    let g:vimwiki_global_ext = 0
    let g:vimwiki_key_mappings = { 'table_mappings': 0, }
    let g:vimwiki_table_mappings = 0
    ```

* [Markdown Preview](https://github.com/iamcco/markdown-preview.nvim): Permite generar una p√°gina web est√°tica con base en archivos markdown (`.md`, `.markdown`), es el plugin que nos permite visualizar las notas en el navegador en tiempo real. Ya incluye soporte para renderizar varias cosas √∫tiles como [KaTeX](https://katex.org/) y [mermaid](https://mermaid-js.github.io/mermaid/#/).

    ![markdown preview](/blogger/assets/markdownPreview.gif)

    Como configuraci√≥n mapeo `<Ctrl-E>` como hotkey para abrir y cerrar la visualizaci√≥n previa. Defino como ser√° el comportamiento de seguir el cursor y  los saltos de l√≠nea (‚Üµ = `<br>`).

    ```vim
    nmap <C-e> <Plug>MarkdownPreviewToggle
    let g:mkdp_preview_options = {
        \ 'mkit': {"breaks": 1},
        \ 'sync_scroll_type': 'middle',
        \ }
    ```

* [Vim Markdown](https://github.com/plasticboy/vim-markdown): Es un *syntax highlighter* que pone de distintos colores lo que escribimos en un archivo markdown para poder identificar de qu√© se trata (t√≠tulos, cuerpo, listas, c√≥digo, etc.). Aunque vimwiki ya hace esto por nosotros, a veces uno quiere escribir un archivo `.md` sin tener que adjuntarlo a la wiki.

    En la configuraci√≥n s√≥lo activo la extensi√≥n de matem√°ticas y desactivo el *folding*:
    ```vim
    let g:vim_markdown_folding_disabled = 1
    let g:vim_markdown_math = 1
    ```
* [coc-snippets](https://github.com/neoclide/coc-snippets): Este es el motivo por el cual elijo este setup. Permite crear nuestros propios snippets, esta extensi√≥n est√° basada en [UltiSnips](https://github.com/SirVer/ultisnips) y tiene la mayor√≠a de sus funcionalidades. Es necesario instalar primero [coc](https://github.com/neoclide/coc.nvim), que es un plugin que permite a√±adir funcionalidades de completar texto, linters y highlighting en distintos lenguajes. Coc-snippets es una extensi√≥n de coc.

    Se configura este para darle a `<TAB>` la funcionalidad de pasar al siguiente snippet de la lista, y con `<ENTER>` se expande.

    ```vim
    inoremap <silent><expr> <TAB>
      \ pumvisible() ? coc#_select_confirm() :
      \ coc#expandableOrJumpable() ? "\<C-r>=coc#rpc#request('doKeymap',['snippets-expand-jump',''])\<CR>" :
      \ <SID>check_back_space() ? "\<TAB>" :
      \ coc#refresh()

    function! s:check_back_space() abort
      let col = col('.') - 1
      return !col || getline('.')[col - 1]  =~# '\s'
    endfunction

    let g:coc_snippet_next = '<tab>'
    xmap <Tab> <Plug>(coc-snippets-select)
    ```

#### Snippets!
Los snippets que m√°s utilizo son para ecuaciones matem√°ticas, por ejemplo para agilizar las fracciones, matrices, estructuras de casos, etc. No pondr√© aqu√≠ todos para no alargar mucho el post y porque hay un [art√≠culo](https://castel.dev/post/lecture-notes-1/#snippets) muy bueno de Gilles Castell (que fue fuente de inspiraci√≥n para este post) donde explica qu√© son los snippets m√°s a fondo y los que √©l usa. Les recomiendo ver [todos sus snippets](https://github.com/gillescastel/latex-snippets/blob/master/tex.snippets) para $\LaTeX$, yo uso algunos de ah√≠ y los de UltiSnips de su art√≠culo.

Sin embargo, √©l los usa para $\LaTeX$ en archivos `.tex`, nosotros usamos $\KaTeX$ en archivos `.md`, al ser diferentes lenguajes, el text highlighter que utilizan es diferente y los [snippets de contexto](https://castel.dev/post/lecture-notes-1/#context) no servir√≠an.

El contexto hace que el snippet se expanda solamente si se encuentra bajo cierto *contexto*, es decir si ciertas **condiciones** se cumplen, en nuestro caso se puede usar a favor para expandir ciertos snippets s√≥lo cuando se est√° en un entorno matem√°tico:

![snippets context](/blogger/assets/snippetsContext.gif)

Como se puede ver, el snippet `bmatrix` s√≥lo se expande cundo est√° entre `$$ $$` o `$ $`, es decir, s√≥lo cuando est√° en un entorno matem√°tico. De hecho se colorea de diferente color, esto es hecho por el highlighter, ya sea el de VimWiki o el de Vim Markdown.

Utilizando esta informaci√≥n, en el archivo de snippets para archivos markdown (que se abre con `:CocCommand snippets.editSnippets` en Neovim) se puede introducir el siguiente c√≥digo para definir el contexto matem√°tico:

```python
global !p
texMathZones = ['texMathZone' + x for x in ['X', 'Y']] + ['mkdMath'] + ["VimwikiMath", "VimwikiEqIn", "textSnipTEX", "texStatement"]
texIgnoreMathZones = ['texMathText']
texMathZoneIds = vim.eval('map('+str(texMathZones)+", 'hlID(v:val)')")
texIgnoreMathZoneIds = vim.eval('map('+str(texIgnoreMathZones)+", 'hlID(v:val)')")
ignore = texIgnoreMathZoneIds[0]

def math():
    synstackids = vim.eval("synstack(line('.'), col('.') - (col('.')>=2 ? 1 : 0))")
    try:
        first = next(i for i in reversed(synstackids) if i in
        texIgnoreMathZoneIds or i in texMathZoneIds)
        return first != ignore
    except StopIteration:
        return False
endglobal
```

Luego para definir el snippet de `bmatrix` bajo este contexto:

```python
context "math()"
snippet bmatrix "[matrix]" iAe
\begin{bmatrix}
	$0
\end{bmatrix}
endsnippet
```

> Para no definir doblemente todos los snippets (para vimwiki y para markdown), conviene importar los snippets en el archivo que menos se modifica, por ejemplo esto lo puse en el archivo de snippets de vimwiki:
>```python
>extends markdown
>```

## P√°gina web de notas
Finalmente, explicar√© como luego de tomar mis notas, puedo subirlas a mi p√°gina web, la cual pueden consultar [aqu√≠](https://danielhj.com/studious/).

Utilizo [GitHub Pages](https://pages.github.com/) con [Jekyll](https://docs.github.com/en/pages/setting-up-a-github-pages-site-with-jekyll/about-github-pages-and-jekyll), as√≠ puedo armar una p√°gina web est√°tica donde s√≥lo tengo que subir un nuevo archivo markdown para tener una nueva nota, que tenga el formato que quiero.

Instal√© Jekyll, cre√© un nuevo proyecto y siguiendo las indicaciones del `Gemfile` adapt√© el proyecto para GitHub pages:

``` ruby
#gem "jekyll", "~> 4.2.0"
# If you want to use GitHub Pages, remove the "gem "jekyll"" above and
# uncomment the line below. To upgrade, run `bundle update github-pages`.
gem "github-pages", group: :jekyll_plugins
```

As√≠ pues, corr√≠ `bundle install` seguido de `bundle update` que tambi√©n actualiza el bundle `github-pages`.

No es la intenci√≥n de este post describir como hice la p√°gina web como tal, pero hay algunas cosas que me parecen interesantes y tal vez les puedan ayudar.

> Jekyll tiene soporte para `Sass` integrado y por tanto s√≥lo hay que hacer un `main.scss` para utilizarlo y as√≠ lo hice.

Jekyll permite crear plantillas de p√°ginas html, basta con especificar en un archivo markdown o html, qu√© plantilla se quiere usar y al convertirse, tendr√° la estructura general de ese plantilla. As√≠ pues, cre√© el layout `_layouts/default.html` donde est√° el c√≥digo para utilizar $\KaTeX$ y `mermaid`. Luego hice dos layouts que extienden a `default.html`: `notes.html` y `index.html` para las notas y los men√∫s respectivamente. Cre√© un directorio donde se encuentran las notas y los men√∫s correspondientes, que es el mismo donde est√° la vimwiki.

La estructura de directorios qued√≥ de la siguiente manera (omitiendo los directorios ocultos):

```
Óóø .
‚îú‚îÄ‚îÄ 404.html
‚îú‚îÄ‚îÄ _config.yml
‚îú‚îÄ‚îÄ Óóø css
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ code.css
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ main.scss
‚îú‚îÄ‚îÄ favicon.ico
‚îú‚îÄ‚îÄ Gemfile
‚îú‚îÄ‚îÄ Gemfile.lock
‚îú‚îÄ‚îÄ Óóø _includes
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ Óóø icons
‚îú‚îÄ‚îÄ index.md
‚îú‚îÄ‚îÄ Óóø _layouts
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ default.html
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ index.html
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ note.html
‚îú‚îÄ‚îÄ Óóø notes
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Óóø 6to Semestre
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Óóø 7mo Semestre
‚îÇ¬†¬† ‚îú‚îÄ‚îÄ Óóø 8vo Semestre
‚îÇ¬†¬† ‚îî‚îÄ‚îÄ Óóø img
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ Óóø _site
```

### Integraci√≥n de $\KaTeX$ en GitHub Pages con Jekyll

Para poder utilizar $\KaTeX$ en GitHub pages de la misma forma que lo implementa Markdown Preview, con `$$ $$` para bloques matem√°ticos y `$ $` para matem√°tica en l√≠nea, es necesario configurarlo. Primero en `./_config.yml`:

```yml
markdown: kramdown

kramdown:
    input: GFM #Saltos de l√≠nea = 
    hard_wrap: true
    math_engine: katex
```

Se configura el interprete de markdown como `kramdown`, que tiene [soporte](https://kramdown.gettalong.org/math_engine/katex.html) para $\KaTeX$, luego se configura el input como `GFM` para que los saltos de l√≠nea sean igual que un `<br>` (si no, ser√≠a [as√≠](https://gist.github.com/shaunlebron/746476e6e7a4d698b373)). El motor de matem√°ticas se configura como `katex`.

Ahora se manda a llamar a $\KaTeX$ en el `<head>`, en mi caso en el `./layouts/default.html`. Pero tambi√©n se manda a llamar al m√©todo que cambia los delimitadores y desactiva el display, as√≠ se puede usar `$ $` para *in-line math*.

```html
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">

    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"
        onload="renderMathInElement(document.body, { delimiters: [ {left: '$', right: '$', display: false} ], throwOnError: false });"></script>
```

### Integraci√≥n de `mermaid` en GitHub Pages con Jekyll
Instal√© tambi√©n [mermaid](https://github.com/mermaid-js/mermaid/blob/develop/docs/usage.md) para renderizar los gr√°ficos de flujo, estado, de Gantt, etc. y cambi√© el tema por uno de mi elecci√≥n.

En el `<head>`:

```html
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
```

Como tal, kramdown no detecta mermaid cuando se declara como bloque de c√≥digo de la siguiente forma:

    ```mermaid

    ```

Para habilitar esto es necesario activar `htmlLabels`. Tambi√©n modifico el tema en el siguiente c√≥digo que va despu√©s del `<body>`:

```html
<script>
    var config = {
        startOnLoad:true,
        theme: 'forest',
        flowchart:{
                useMaxWidth:false,
                htmlLabels:true
            }
    };
    mermaid.initialize(config);
    window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid'));
</script>
```

### Workflow
Con este setup, lo √∫nico que tengo que hacer es agregar una entrada en el archivo `index.md` hacia la nota `<t√≠tulo de la nota>.md`, agregar el front matter al inicio del archivo creado para utilizar el layout de `note`:

```
---
layout: note
---
```

Escribo algo y hago un commit al repositorio en GitHub y autom√°ticamente se despliega en la p√°gina.

Algo que ayuda bastante es que no necesito poner los t√≠tulos manualmente, pues en la p√°gina se muestran con el nombre del archivo como t√≠tulo de la nota. Adem√°s en los √≠ndices, se muestra un √°rbol de los directorios con links a los √≠ndices correspondientes. Todo esto se hace se forma autom√°tica y en este [art√≠culo](/#) explico como se hace.


## Conclusiones
Este setup cumple con los requisitos que plantee sobre una buena herramienta para tomar mis notas y personalmente me encanta ü§©.

La √∫nica deficiencia que puede tener este arreglo es al momento de dibujar, pues no es muy c√≥modo hacerlo en la PC y aunque se pueden obtener dibujos incluso mejores, hacerlo implica mucho tiempo.

Quiero implementar m√°s cosas a este setup, que pueden ayudar a corregir esto y me guiar√© de este [art√≠culo](https://castel.dev/post/lecture-notes-2/) para implementarlo en `WSL`. Tambi√©n me gustar√≠a implementar b√∫squeda entre las notas en la p√°gina web.
